From cb340499bf4433cfd35f1b3b28c0eb0f89d87f24 Mon Sep 17 00:00:00 2001
From: oItsMineZ <135024283+oItsMineZ@users.noreply.github.com>
Date: Wed, 11 Jun 2025 03:53:09 -0700
Subject: [PATCH] Disable background blur on power menu

---
 .../com/android/server/wm/WindowState.smali   | 347 ------------------
 1 file changed, 347 deletions(-)

diff --git a/smali_classes3/com/android/server/wm/WindowState.smali b/smali_classes3/com/android/server/wm/WindowState.smali
index 8f3a9e5c..c1da1e2b 100644
--- a/smali_classes3/com/android/server/wm/WindowState.smali
+++ b/smali_classes3/com/android/server/wm/WindowState.smali
@@ -7015,355 +7015,8 @@
 .method public applyBlurEffectInTransaction(Landroid/view/SurfaceControl$Transaction;)V
     .locals 14
 
-    iget-object v0, p0, Lcom/android/server/wm/WindowState;->mWinAnimator:Lcom/android/server/wm/WindowStateAnimator;
-
-    if-nez v0, :cond_0
-
-    return-void
-
-    :cond_0
-    iget-object v0, p0, Lcom/android/server/wm/WindowState;->mAttrs:Landroid/view/WindowManager$LayoutParams;
-
-    iget v0, v0, Landroid/view/WindowManager$LayoutParams;->flags:I
-
-    and-int/lit8 v0, v0, 0x2
-
-    const/4 v1, 0x0
-
-    if-eqz v0, :cond_1
-
-    iget-object v0, p0, Lcom/android/server/wm/WindowState;->mAttrs:Landroid/view/WindowManager$LayoutParams;
-
-    iget v0, v0, Landroid/view/WindowManager$LayoutParams;->samsungFlags:I
-
-    and-int/lit8 v0, v0, 0x40
-
-    if-eqz v0, :cond_1
-
-    const/4 v0, 0x1
-
-    goto :goto_0
-
-    :cond_1
-    move v0, v1
-
-    :goto_0
-    iget-object v2, p0, Lcom/android/server/wm/WindowState;->mAttrs:Landroid/view/WindowManager$LayoutParams;
-
-    iget v2, v2, Landroid/view/WindowManager$LayoutParams;->dimAmount:F
-
-    const/4 v3, 0x0
-
-    if-eqz v0, :cond_3
-
-    invoke-virtual {p0}, Lcom/android/server/wm/WindowState;->inSplitScreenWindowingMode()Z
-
-    move-result v4
-
-    if-eqz v4, :cond_3
-
-    iget-object v4, p0, Lcom/android/server/wm/WindowState;->mActivityRecord:Lcom/android/server/wm/ActivityRecord;
-
-    if-eqz v4, :cond_3
-
-    iget-boolean v4, v4, Lcom/android/server/wm/ActivityRecord;->mVisibleRequested:Z
-
-    if-eqz v4, :cond_2
-
-    iget-object v4, p0, Lcom/android/server/wm/WindowState;->mDisplayContent:Lcom/android/server/wm/DisplayContent;
-
-    iget-object v4, v4, Lcom/android/server/wm/DisplayContent;->mClosingApps:Landroid/util/ArraySet;
-
-    iget-object v5, p0, Lcom/android/server/wm/WindowState;->mActivityRecord:Lcom/android/server/wm/ActivityRecord;
-
-    invoke-virtual {v4, v5}, Landroid/util/ArraySet;->contains(Ljava/lang/Object;)Z
-
-    move-result v4
-
-    if-eqz v4, :cond_3
-
-    :cond_2
     const/4 v0, 0x0
 
-    :cond_3
-    if-eqz v0, :cond_4
-
-    invoke-direct {p0, v2}, Lcom/android/server/wm/WindowState;->getLegacyBlurRadius(F)I
-
-    move-result v4
-
-    goto :goto_1
-
-    :cond_4
-    move v4, v1
-
-    :goto_1
-    if-eqz v0, :cond_5
-
-    invoke-direct {p0, v2}, Lcom/android/server/wm/WindowState;->getLegacySaturation(F)I
-
-    move-result v5
-
-    goto :goto_2
-
-    :cond_5
-    move v5, v1
-
-    :goto_2
-    iget v6, p0, Lcom/android/server/wm/WindowState;->mLastBlurRadius:I
-
-    if-ne v6, v4, :cond_6
-
-    iget v6, p0, Lcom/android/server/wm/WindowState;->mLastSat:I
-
-    if-ne v6, v5, :cond_6
-
-    return-void
-
-    :cond_6
-    iget-object v6, p0, Lcom/android/server/wm/WindowState;->mAttrs:Landroid/view/WindowManager$LayoutParams;
-
-    iget-wide v6, v6, Landroid/view/WindowManager$LayoutParams;->dimDuration:J
-
-    const-wide/16 v8, -0x1
-
-    cmp-long v6, v6, v8
-
-    if-eqz v6, :cond_7
-
-    iget-object v6, p0, Lcom/android/server/wm/WindowState;->mAttrs:Landroid/view/WindowManager$LayoutParams;
-
-    iget-wide v6, v6, Landroid/view/WindowManager$LayoutParams;->dimDuration:J
-
-    goto :goto_3
-
-    :cond_7
-    const-wide/16 v6, 0xc8
-
-    :goto_3
-    invoke-static {}, Landroid/view/SurfaceEffects;->newBuilder()Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v8
-
-    sget-object v9, Landroid/view/SurfaceEffects$PixEffectType;->BLUR:Landroid/view/SurfaceEffects$PixEffectType;
-
-    invoke-virtual {v8, v9}, Landroid/view/SurfaceEffects$Effect$Builder;->setPixelEffectType(Landroid/view/SurfaceEffects$PixEffectType;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v8
-
-    iget-object v9, p0, Lcom/android/server/wm/WindowState;->mAttrs:Landroid/view/WindowManager$LayoutParams;
-
-    iget v9, v9, Landroid/view/WindowManager$LayoutParams;->height:I
-
-    const/4 v10, -0x2
-
-    if-eq v9, v10, :cond_8
-
-    iget-object v9, p0, Lcom/android/server/wm/WindowState;->mAttrs:Landroid/view/WindowManager$LayoutParams;
-
-    iget v9, v9, Landroid/view/WindowManager$LayoutParams;->width:I
-
-    if-ne v9, v10, :cond_9
-
-    :cond_8
-    invoke-virtual {v8}, Landroid/view/SurfaceEffects$Effect$Builder;->makeFullscreen()Landroid/view/SurfaceEffects$Effect$Builder;
-
-    :cond_9
-    if-lez v4, :cond_a
-
-    sget-object v9, Landroid/view/SurfaceEffects$AnimationMode;->ONCE_STAY_END:Landroid/view/SurfaceEffects$AnimationMode;
-
-    invoke-virtual {v8, v9}, Landroid/view/SurfaceEffects$Effect$Builder;->setAnimationMode(Landroid/view/SurfaceEffects$AnimationMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v9
-
-    sget-object v10, Landroid/view/SurfaceEffects$AnimParam;->BLUR_RADIUS:Landroid/view/SurfaceEffects$AnimParam;
-
-    iget v11, p0, Lcom/android/server/wm/WindowState;->mLastBlurRadius:I
-
-    int-to-float v11, v11
-
-    sget-object v12, Landroid/view/SurfaceEffects$InterpMode;->HOLD:Landroid/view/SurfaceEffects$InterpMode;
-
-    invoke-virtual {v9, v10, v1, v11, v12}, Landroid/view/SurfaceEffects$Effect$Builder;->addPixAnimation(Landroid/view/SurfaceEffects$AnimParam;IFLandroid/view/SurfaceEffects$InterpMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v9
-
-    sget-object v10, Landroid/view/SurfaceEffects$AnimParam;->BLUR_RADIUS:Landroid/view/SurfaceEffects$AnimParam;
-
-    long-to-int v11, v6
-
-    int-to-float v12, v4
-
-    sget-object v13, Landroid/view/SurfaceEffects$InterpMode;->SMOOTH_IN:Landroid/view/SurfaceEffects$InterpMode;
-
-    invoke-virtual {v9, v10, v11, v12, v13}, Landroid/view/SurfaceEffects$Effect$Builder;->addPixAnimation(Landroid/view/SurfaceEffects$AnimParam;IFLandroid/view/SurfaceEffects$InterpMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v9
-
-    sget-object v10, Landroid/view/SurfaceEffects$AnimParam;->BLUR_SATURATION:Landroid/view/SurfaceEffects$AnimParam;
-
-    iget v11, p0, Lcom/android/server/wm/WindowState;->mLastSat:I
-
-    int-to-float v11, v11
-
-    sget-object v12, Landroid/view/SurfaceEffects$InterpMode;->HOLD:Landroid/view/SurfaceEffects$InterpMode;
-
-    invoke-virtual {v9, v10, v1, v11, v12}, Landroid/view/SurfaceEffects$Effect$Builder;->addPixAnimation(Landroid/view/SurfaceEffects$AnimParam;IFLandroid/view/SurfaceEffects$InterpMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v1
-
-    sget-object v9, Landroid/view/SurfaceEffects$AnimParam;->BLUR_SATURATION:Landroid/view/SurfaceEffects$AnimParam;
-
-    long-to-int v10, v6
-
-    int-to-float v11, v5
-
-    sget-object v12, Landroid/view/SurfaceEffects$InterpMode;->SMOOTH_IN:Landroid/view/SurfaceEffects$InterpMode;
-
-    invoke-virtual {v1, v9, v10, v11, v12}, Landroid/view/SurfaceEffects$Effect$Builder;->addPixAnimation(Landroid/view/SurfaceEffects$AnimParam;IFLandroid/view/SurfaceEffects$InterpMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    goto :goto_4
-
-    :cond_a
-    sget-object v9, Landroid/view/SurfaceEffects$AnimationMode;->ONCE_DESTROY:Landroid/view/SurfaceEffects$AnimationMode;
-
-    invoke-virtual {v8, v9}, Landroid/view/SurfaceEffects$Effect$Builder;->setAnimationMode(Landroid/view/SurfaceEffects$AnimationMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v9
-
-    sget-object v10, Landroid/view/SurfaceEffects$AnimParam;->BLUR_RADIUS:Landroid/view/SurfaceEffects$AnimParam;
-
-    iget v11, p0, Lcom/android/server/wm/WindowState;->mLastBlurRadius:I
-
-    int-to-float v11, v11
-
-    sget-object v12, Landroid/view/SurfaceEffects$InterpMode;->HOLD:Landroid/view/SurfaceEffects$InterpMode;
-
-    invoke-virtual {v9, v10, v1, v11, v12}, Landroid/view/SurfaceEffects$Effect$Builder;->addPixAnimation(Landroid/view/SurfaceEffects$AnimParam;IFLandroid/view/SurfaceEffects$InterpMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v9
-
-    sget-object v10, Landroid/view/SurfaceEffects$AnimParam;->BLUR_RADIUS:Landroid/view/SurfaceEffects$AnimParam;
-
-    long-to-int v11, v6
-
-    int-to-float v12, v4
-
-    sget-object v13, Landroid/view/SurfaceEffects$InterpMode;->SMOOTH_OUT:Landroid/view/SurfaceEffects$InterpMode;
-
-    invoke-virtual {v9, v10, v11, v12, v13}, Landroid/view/SurfaceEffects$Effect$Builder;->addPixAnimation(Landroid/view/SurfaceEffects$AnimParam;IFLandroid/view/SurfaceEffects$InterpMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v9
-
-    sget-object v10, Landroid/view/SurfaceEffects$AnimParam;->BLUR_SATURATION:Landroid/view/SurfaceEffects$AnimParam;
-
-    iget v11, p0, Lcom/android/server/wm/WindowState;->mLastSat:I
-
-    int-to-float v11, v11
-
-    sget-object v12, Landroid/view/SurfaceEffects$InterpMode;->HOLD:Landroid/view/SurfaceEffects$InterpMode;
-
-    invoke-virtual {v9, v10, v1, v11, v12}, Landroid/view/SurfaceEffects$Effect$Builder;->addPixAnimation(Landroid/view/SurfaceEffects$AnimParam;IFLandroid/view/SurfaceEffects$InterpMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    move-result-object v1
-
-    sget-object v9, Landroid/view/SurfaceEffects$AnimParam;->BLUR_SATURATION:Landroid/view/SurfaceEffects$AnimParam;
-
-    long-to-int v10, v6
-
-    const/4 v11, 0x0
-
-    sget-object v12, Landroid/view/SurfaceEffects$InterpMode;->SMOOTH_OUT:Landroid/view/SurfaceEffects$InterpMode;
-
-    invoke-virtual {v1, v9, v10, v11, v12}, Landroid/view/SurfaceEffects$Effect$Builder;->addPixAnimation(Landroid/view/SurfaceEffects$AnimParam;IFLandroid/view/SurfaceEffects$InterpMode;)Landroid/view/SurfaceEffects$Effect$Builder;
-
-    :goto_4
-    sget-boolean v1, Lcom/samsung/android/rune/CoreRune;->SAFE_DEBUG:Z
-
-    if-eqz v1, :cond_b
-
-    new-instance v1, Ljava/lang/StringBuilder;
-
-    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V
-
-    const-string v9, "applyBlurEffectInTransaction, duration="
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    invoke-virtual {v1, v6, v7}, Ljava/lang/StringBuilder;->append(J)Ljava/lang/StringBuilder;
-
-    const-string v9, ", blurRadius="
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    invoke-virtual {v1, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    const-string v9, ", mLastBlurRadius="
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    iget v9, p0, Lcom/android/server/wm/WindowState;->mLastBlurRadius:I
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    const-string v9, ", saturation="
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    invoke-virtual {v1, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    const-string v9, ", mLastSat="
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    iget v9, p0, Lcom/android/server/wm/WindowState;->mLastSat:I
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    const-string v9, ", dimAmount="
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    iget-object v9, p0, Lcom/android/server/wm/WindowState;->mAttrs:Landroid/view/WindowManager$LayoutParams;
-
-    iget v9, v9, Landroid/view/WindowManager$LayoutParams;->dimAmount:F
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(F)Ljava/lang/StringBuilder;
-
-    const-string v9, ", win="
-
-    invoke-virtual {v1, v9}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    invoke-virtual {v1, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
-
-    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
-
-    move-result-object v1
-
-    const-string v9, "WindowManager"
-
-    invoke-static {v9, v1}, Landroid/util/Slog;->d(Ljava/lang/String;Ljava/lang/String;)I
-
-    :cond_b
-    invoke-virtual {v8}, Landroid/view/SurfaceEffects$Effect$Builder;->build()Landroid/view/SurfaceEffects$Effect;
-
-    move-result-object v1
-
-    invoke-virtual {v1}, Landroid/view/SurfaceEffects$Effect;->getBytes()Ljava/lang/String;
-
-    move-result-object v1
-
-    iget-object v9, p0, Lcom/android/server/wm/WindowState;->mWinAnimator:Lcom/android/server/wm/WindowStateAnimator;
-
-    iget-object v9, v9, Lcom/android/server/wm/WindowStateAnimator;->mSurfaceController:Lcom/android/server/wm/WindowSurfaceController;
-
-    invoke-virtual {v9, p1, v1}, Lcom/android/server/wm/WindowSurfaceController;->startSurfaceAnimationInTransaction(Landroid/view/SurfaceControl$Transaction;Ljava/lang/String;)Z
-
-    iput v4, p0, Lcom/android/server/wm/WindowState;->mLastBlurRadius:I
-
-    iput v5, p0, Lcom/android/server/wm/WindowState;->mLastSat:I
-
     return-void
 .end method
 
-- 
2.43.0

